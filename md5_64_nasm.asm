; Netwide Assembler-compatible .asm

; This body of the MD5_Transform function in this file is automatically produced by ndisasm -b 64 -p intel

%ifndef WIN64_ABI
%ifndef LINUIX_AMD64_ABI
; by default, we asume that we are compiling for Windows calling convention
%define WIN64_ABI
%endif
%endif

; For Windows, we use Microsoft's Win64 "The x64 Application Binary Interface (ABI)" (x64 ABI) calling convention: rcx - first argument, rdx - second argument
; According to Microsoft, "The x64 ABI considers registers RBX, RBP, RDI, RSI, RSP, R12, R13, R14, R15, and XMM6-XMM15 nonvolatile. They must be saved and restored by a function that uses them".
; Use the following command to assemble for Windows:
; nasm -f win64 -DWIN64_ABI md5_64_nasm.asm 

; For Unix (Linux), we use "System V AMD64 ABI" calling convention: rdi - first argument, rsi - second argument
; According to System V AMD64 ABI, the registers rbx, rbp and r12-r15 should be preserved by the callee (the function being called), while the other registers, including rdi and rsi, can be modified by the callee.
; Use the following command to assemble for Linux:
; nasm -f elf64 -DLINUIX_AMD64_ABI md5_64_nasm.asm 

section	.text
global MD5_Transform
MD5_Transform: 
push rbx
%ifndef WIN64_ABI
push rsi
push rdi
%endif
push rbp
push r12
push r13
push r14
push r15
%ifdef WIN64_ABI
mov r15,rcx
mov r14,rdx
%endif
%ifdef LINUIX_AMD64_ABI
mov r15,rdi
mov r14,rsi
%endif
mov eax,[r15]
mov ebx,[r15+0x4]
mov ecx,[r15+0x8]
mov edx,[r15+0xc]
mov rbp,[r14]
mov r8,[r14+0x8]
mov r9,[r14+0x10]
mov r10,[r14+0x18]
mov r11,[r14+0x20]
mov r12,[r14+0x28]
mov r13,[r14+0x30]
mov r14,[r14+0x38]
add eax,0xd76aa478
add eax,ebp
mov esi,ebx
not esi
and esi,edx
mov edi,ecx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x7
add eax,ebx
ror rbp,0x20
add edx,0xe8c7b756
add edx,ebp
mov esi,eax
not esi
and esi,ecx
mov edi,ebx
and edi,eax
or esi,edi
add edx,esi
rol edx,0xc
add edx,eax
add ecx,0x242070db
add ecx,r8d
mov esi,edx
not esi
and esi,ebx
mov edi,eax
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0x11
add ecx,edx
ror r8,0x20
add ebx,0xc1bdceee
add ebx,r8d
mov esi,ecx
not esi
and esi,eax
mov edi,edx
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x16
add ebx,ecx
add eax,0xf57c0faf
add eax,r9d
mov esi,ebx
not esi
and esi,edx
mov edi,ecx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x7
add eax,ebx
ror r9,0x20
add edx,0x4787c62a
add edx,r9d
mov esi,eax
not esi
and esi,ecx
mov edi,ebx
and edi,eax
or esi,edi
add edx,esi
rol edx,0xc
add edx,eax
add ecx,0xa8304613
add ecx,r10d
mov esi,edx
not esi
and esi,ebx
mov edi,eax
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0x11
add ecx,edx
ror r10,0x20
add ebx,0xfd469501
add ebx,r10d
mov esi,ecx
not esi
and esi,eax
mov edi,edx
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x16
add ebx,ecx
add eax,0x698098d8
add eax,r11d
mov esi,ebx
not esi
and esi,edx
mov edi,ecx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x7
add eax,ebx
ror r11,0x20
add edx,0x8b44f7af
add edx,r11d
mov esi,eax
not esi
and esi,ecx
mov edi,ebx
and edi,eax
or esi,edi
add edx,esi
rol edx,0xc
add edx,eax
add ecx,0xffff5bb1
add ecx,r12d
mov esi,edx
not esi
and esi,ebx
mov edi,eax
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0x11
add ecx,edx
ror r12,0x20
add ebx,0x895cd7be
add ebx,r12d
mov esi,ecx
not esi
and esi,eax
mov edi,edx
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x16
add ebx,ecx
add eax,0x6b901122
add eax,r13d
mov esi,ebx
not esi
and esi,edx
mov edi,ecx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x7
add eax,ebx
ror r13,0x20
add edx,0xfd987193
add edx,r13d
mov esi,eax
not esi
and esi,ecx
mov edi,ebx
and edi,eax
or esi,edi
add edx,esi
rol edx,0xc
add edx,eax
add ecx,0xa679438e
add ecx,r14d
mov esi,edx
not esi
and esi,ebx
mov edi,eax
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0x11
add ecx,edx
ror r14,0x20
add ebx,0x49b40821
add ebx,r14d
mov esi,ecx
not esi
and esi,eax
mov edi,edx
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x16
add ebx,ecx
add eax,0xf61e2562
add eax,ebp
mov esi,edx
not esi
and esi,ecx
mov edi,edx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x5
add eax,ebx
ror r10,0x20
add edx,0xc040b340
add edx,r10d
mov esi,ecx
not esi
and esi,ebx
mov edi,ecx
and edi,eax
or esi,edi
add edx,esi
rol edx,0x9
add edx,eax
add ecx,0x265e5a51
add ecx,r12d
mov esi,ebx
not esi
and esi,eax
mov edi,ebx
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0xe
add ecx,edx
ror rbp,0x20
add ebx,0xe9b6c7aa
add ebx,ebp
mov esi,eax
not esi
and esi,edx
mov edi,eax
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x14
add ebx,ecx
add eax,0xd62f105d
add eax,r9d
mov esi,edx
not esi
and esi,ecx
mov edi,edx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x5
add eax,ebx
ror r12,0x20
add edx,0x2441453
add edx,r12d
mov esi,ecx
not esi
and esi,ebx
mov edi,ecx
and edi,eax
or esi,edi
add edx,esi
rol edx,0x9
add edx,eax
add ecx,0xd8a1e681
add ecx,r14d
mov esi,ebx
not esi
and esi,eax
mov edi,ebx
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0xe
add ecx,edx
ror r9,0x20
add ebx,0xe7d3fbc8
add ebx,r9d
mov esi,eax
not esi
and esi,edx
mov edi,eax
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x14
add ebx,ecx
add eax,0x21e1cde6
add eax,r11d
mov esi,edx
not esi
and esi,ecx
mov edi,edx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x5
add eax,ebx
ror r14,0x20
add edx,0xc33707d6
add edx,r14d
mov esi,ecx
not esi
and esi,ebx
mov edi,ecx
and edi,eax
or esi,edi
add edx,esi
rol edx,0x9
add edx,eax
add ecx,0xf4d50d87
add ecx,r8d
mov esi,ebx
not esi
and esi,eax
mov edi,ebx
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0xe
add ecx,edx
ror r11,0x20
add ebx,0x455a14ed
add ebx,r11d
mov esi,eax
not esi
and esi,edx
mov edi,eax
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x14
add ebx,ecx
add eax,0xa9e3e905
add eax,r13d
mov esi,edx
not esi
and esi,ecx
mov edi,edx
and edi,ebx
or esi,edi
add eax,esi
rol eax,0x5
add eax,ebx
ror r8,0x20
add edx,0xfcefa3f8
add edx,r8d
mov esi,ecx
not esi
and esi,ebx
mov edi,ecx
and edi,eax
or esi,edi
add edx,esi
rol edx,0x9
add edx,eax
ror r10,0x20
add ecx,0x676f02d9
add ecx,r10d
mov esi,ebx
not esi
and esi,eax
mov edi,ebx
and edi,edx
or esi,edi
add ecx,esi
rol ecx,0xe
add ecx,edx
ror r13,0x20
add ebx,0x8d2a4c8a
add ebx,r13d
mov esi,eax
not esi
and esi,edx
mov edi,eax
and edi,ecx
or esi,edi
add ebx,esi
rol ebx,0x14
add ebx,ecx
ror r9,0x20
add eax,0xfffa3942
add eax,r9d
mov esi,edx
xor esi,ecx
xor esi,ebx
add eax,esi
rol eax,0x4
add eax,ebx
add edx,0x8771f681
add edx,r11d
mov esi,ecx
xor esi,ebx
xor esi,eax
add edx,esi
rol edx,0xb
add edx,eax
ror r12,0x20
add ecx,0x6d9d6122
add ecx,r12d
mov esi,ebx
xor esi,eax
xor esi,edx
add ecx,esi
rol ecx,0x10
add ecx,edx
add ebx,0xfde5380c
add ebx,r14d
mov esi,eax
xor esi,edx
xor esi,ecx
add ebx,esi
rol ebx,0x17
add ebx,ecx
ror rbp,0x20
add eax,0xa4beea44
add eax,ebp
mov esi,edx
xor esi,ecx
xor esi,ebx
add eax,esi
rol eax,0x4
add eax,ebx
ror r9,0x20
add edx,0x4bdecfa9
add edx,r9d
mov esi,ecx
xor esi,ebx
xor esi,eax
add edx,esi
rol edx,0xb
add edx,eax
add ecx,0xf6bb4b60
add ecx,r10d
mov esi,ebx
xor esi,eax
xor esi,edx
add ecx,esi
rol ecx,0x10
add ecx,edx
ror r12,0x20
add ebx,0xbebfbc70
add ebx,r12d
mov esi,eax
xor esi,edx
xor esi,ecx
add ebx,esi
rol ebx,0x17
add ebx,ecx
ror r13,0x20
add eax,0x289b7ec6
add eax,r13d
mov esi,edx
xor esi,ecx
xor esi,ebx
add eax,esi
rol eax,0x4
add eax,ebx
ror rbp,0x20
add edx,0xeaa127fa
add edx,ebp
mov esi,ecx
xor esi,ebx
xor esi,eax
add edx,esi
rol edx,0xb
add edx,eax
ror r8,0x20
add ecx,0xd4ef3085
add ecx,r8d
mov esi,ebx
xor esi,eax
xor esi,edx
add ecx,esi
rol ecx,0x10
add ecx,edx
ror r10,0x20
add ebx,0x4881d05
add ebx,r10d
mov esi,eax
xor esi,edx
xor esi,ecx
add ebx,esi
rol ebx,0x17
add ebx,ecx
ror r11,0x20
add eax,0xd9d4d039
add eax,r11d
mov esi,edx
xor esi,ecx
xor esi,ebx
add eax,esi
rol eax,0x4
add eax,ebx
ror r13,0x20
add edx,0xe6db99e5
add edx,r13d
mov esi,ecx
xor esi,ebx
xor esi,eax
add edx,esi
rol edx,0xb
add edx,eax
ror r14,0x20
add ecx,0x1fa27cf8
add ecx,r14d
mov esi,ebx
xor esi,eax
xor esi,edx
add ecx,esi
rol ecx,0x10
add ecx,edx
ror r8,0x20
add ebx,0xc4ac5665
add ebx,r8d
mov esi,eax
xor esi,edx
xor esi,ecx
add ebx,esi
rol ebx,0x17
add ebx,ecx
add eax,0xf4292244
add eax,ebp
mov esi,edx
not esi
or esi,ebx
xor esi,ecx
add eax,esi
rol eax,0x6
add eax,ebx
ror r10,0x20
add edx,0x432aff97
add edx,r10d
mov esi,ecx
not esi
or esi,eax
xor esi,ebx
add edx,esi
rol edx,0xa
add edx,eax
ror r14,0x20
add ecx,0xab9423a7
add ecx,r14d
mov esi,ebx
not esi
or esi,edx
xor esi,eax
add ecx,esi
rol ecx,0xf
add ecx,edx
ror r9,0x20
add ebx,0xfc93a039
add ebx,r9d
mov esi,eax
not esi
or esi,ecx
xor esi,edx
add ebx,esi
rol ebx,0x15
add ebx,ecx
add eax,0x655b59c3
add eax,r13d
mov esi,edx
not esi
or esi,ebx
xor esi,ecx
add eax,esi
rol eax,0x6
add eax,ebx
ror r8,0x20
add edx,0x8f0ccc92
add edx,r8d
mov esi,ecx
not esi
or esi,eax
xor esi,ebx
add edx,esi
rol edx,0xa
add edx,eax
add ecx,0xffeff47d
add ecx,r12d
mov esi,ebx
not esi
or esi,edx
xor esi,eax
add ecx,esi
rol ecx,0xf
add ecx,edx
ror rbp,0x20
add ebx,0x85845dd1
add ebx,ebp
mov esi,eax
not esi
or esi,ecx
xor esi,edx
add ebx,esi
rol ebx,0x15
add ebx,ecx
ror r11,0x20
add eax,0x6fa87e4f
add eax,r11d
mov esi,edx
not esi
or esi,ebx
xor esi,ecx
add eax,esi
rol eax,0x6
add eax,ebx
ror r14,0x20
add edx,0xfe2ce6e0
add edx,r14d
mov esi,ecx
not esi
or esi,eax
xor esi,ebx
add edx,esi
rol edx,0xa
add edx,eax
ror r10,0x20
add ecx,0xa3014314
add ecx,r10d
mov esi,ebx
not esi
or esi,edx
xor esi,eax
add ecx,esi
rol ecx,0xf
add ecx,edx
ror r13,0x20
add ebx,0x4e0811a1
add ebx,r13d
mov esi,eax
not esi
or esi,ecx
xor esi,edx
add ebx,esi
rol ebx,0x15
add ebx,ecx
ror r9,0x20
add eax,0xf7537e82
add eax,r9d
mov esi,edx
not esi
or esi,ebx
xor esi,ecx
add eax,esi
rol eax,0x6
add eax,ebx
ror r12,0x20
add edx,0xbd3af235
add edx,r12d
mov esi,ecx
not esi
or esi,eax
xor esi,ebx
add edx,esi
rol edx,0xa
add edx,eax
ror r8,0x20
add ecx,0x2ad7d2bb
add ecx,r8d
mov esi,ebx
not esi
or esi,edx
xor esi,eax
add ecx,esi
rol ecx,0xf
add ecx,edx
ror r11,0x20
add ebx,0xeb86d391
add ebx,r11d
mov esi,eax
not esi
or esi,ecx
xor esi,edx
add ebx,esi
rol ebx,0x15
add ebx,ecx
add [r15],eax
add [r15+0x4],ebx
add [r15+0x8],ecx
add [r15+0xc],edx
pop r15
pop r14
pop r13
pop r12
pop rbp
%ifndef WIN64_ABI
pop rdi
pop rsi
%endif
pop rbx
ret
